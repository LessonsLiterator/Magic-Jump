<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Magic Jump</title>
    <link rel="icon" type="image/png" href="mark.png">
    <style>
        body { margin: 0; overflow: hidden; background: #000; display: flex; flex-direction: column; align-items: center; justify-content: flex-start; height: 100vh; font-family: sans-serif; touch-action: none; -webkit-user-select: none; user-select: none; }
        #header-logo { display: flex; align-items: center; justify-content: center; gap: 12px; padding: 15px 0; width: 100%; background: #000; color: white; border-bottom: 1px solid #333; }
        #header-logo img { width: 32px; height: 32px; object-fit: contain; }
        #header-logo span { font-size: 24px; font-weight: bold; letter-spacing: 1px; }
        #game-container { position: relative; display: flex; justify-content: center; align-items: flex-start; width: 100%; flex-grow: 1; overflow: hidden; }
        canvas { border: 2px solid #fff; max-width: 100%; max-height: calc(100vh - 80px); background: #000; display: block; }
        #ui { position: absolute; color: white; top: 15px; left: 20px; font-size: 20px; font-weight: bold; text-shadow: 2px 2px 4px #000; pointer-events: none; z-index: 10; }
        #watermark { position: absolute; bottom: 15px; color: rgba(255, 255, 255, 0.3); font-size: 14px; font-weight: bold; pointer-events: none; z-index: 10; }
    </style>
</head>
<body>

<header id="header-logo">
    <img src="back.png" alt="MagicBlock Logo">
    <span>MagicBlock</span>
</header>

<div id="game-container">
    <div id="ui">Altitude: <span id="score">0</span> m</div>
    <div id="watermark">Created by Himas</div>
    <canvas id="gameCanvas"></canvas>
</div>

<script>
const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');
const scoreElement = document.getElementById('score');

canvas.width = 400;
canvas.height = 700;

let score = 0;
let gravity = 0.22;
let jumpStrength = -10.5;
let platforms = [];
let clouds = [];
let stars = [];
let gameState = 'start'; 
let audioCtx = null;
let musicStarted = false;

const wizardImg = new Image();
wizardImg.src = 'wizard.png';

const bgMusic = new Audio('https://cdn.pixabay.com/audio/2022/03/15/audio_7306915f07.mp3');
bgMusic.loop = true;
bgMusic.volume = 0.2;

function initAudio() {
    if (!audioCtx) {
        audioCtx = new (window.AudioContext || window.webkitAudioContext)();
    }
    if (!musicStarted) {
        bgMusic.play().catch(() => {});
        musicStarted = true;
    }
}

function playSound(freq, type, duration, slide) {
    if (!audioCtx) return;
    const osc = audioCtx.createOscillator();
    const gain = audioCtx.createGain();
    osc.type = type;
    osc.frequency.setValueAtTime(freq, audioCtx.currentTime);
    if (slide) osc.frequency.exponentialRampToValueAtTime(slide, audioCtx.currentTime + duration);
    gain.gain.setValueAtTime(0.1, audioCtx.currentTime);
    gain.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + duration);
    osc.connect(gain);
    gain.connect(audioCtx.destination);
    osc.start();
    osc.stop(audioCtx.currentTime + duration);
}

const wizard = {
    x: 170, y: canvas.height - 110, w: 55, h: 55,
    vx: 0, vy: 0,
    draw() {
        if (wizardImg.complete) ctx.drawImage(wizardImg, this.x, this.y, this.w, this.h);
        else { ctx.fillStyle = '#8e44ad'; ctx.fillRect(this.x, this.y, this.w, this.h); }
    },
    update() {
        this.vy += gravity;
        this.y += this.vy;
        this.x += this.vx;
        if (this.x + this.w < 0) this.x = canvas.width;
        if (this.x > canvas.width) this.x = -this.w;
        if (this.y > canvas.height) {
            if (gameState === 'playing') playSound(150, 'sawtooth', 0.5, 50);
            gameState = 'gameover';
        }
    }
};

function initBackdrop() {
    clouds = [];
    for(let i=0; i<6; i++) {
        clouds.push({ x: Math.random() * canvas.width, y: Math.random() * canvas.height, s: 0.1 + Math.random() * 0.3, w: 80 + Math.random() * 100 });
    }
    stars = [];
    for(let i=0; i<80; i++) {
        stars.push({ x: Math.random() * canvas.width, y: Math.random() * canvas.height, r: Math.random() * 1.2 });
    }
}

function drawBackground() {
    let topCol, botCol;
    if (score < 1500) { topCol = '#4dabf7'; botCol = '#d0ebff'; }
    else if (score < 5000) { topCol = '#1971c2'; botCol = '#4dabf7'; }
    else if (score < 10000) { topCol = '#2b2d42'; botCol = '#1971c2'; }
    else { topCol = '#020205'; botCol = '#1a2a6c'; }
    let grd = ctx.createLinearGradient(0, 0, 0, canvas.height);
    grd.addColorStop(0, topCol);
    grd.addColorStop(1, botCol);
    ctx.fillStyle = grd;
    ctx.fillRect(0, 0, canvas.width, canvas.height);
    if (score < 800) {
        ctx.fillStyle = '#2d5a27';
        ctx.fillRect(0, (canvas.height - 55) + score, canvas.width, 800);
    }
    if (score > 4000) {
        ctx.globalAlpha = Math.min(1, (score - 4000) / 4000);
        ctx.fillStyle = "white";
        stars.forEach(s => { ctx.beginPath(); ctx.arc(s.x, s.y, s.r, 0, Math.PI*2); ctx.fill(); });
        ctx.globalAlpha = 1;
    }
    ctx.fillStyle = "rgba(255, 255, 255, 0.5)";
    clouds.forEach(c => {
        ctx.beginPath(); ctx.ellipse(c.x, c.y, c.w/2, 25, 0, 0, Math.PI*2); ctx.fill();
        c.y += c.s;
        if (c.y > canvas.height) { c.y = -50; c.x = Math.random() * canvas.width; }
    });
}

function createPlatform(y) {
    let type = 'normal';
    let r = Math.random();
    if (score > 1500 && r > 0.75) type = 'moving';
    if (score > 3500 && r > 0.9) type = 'fragile';
    return { x: Math.random() * (canvas.width - 75), y: y, w: 75, h: 18, type: type, dir: Math.random() > 0.5 ? 1 : -1, active: true };
}

function drawPlatforms() {
    platforms.forEach(p => {
        if (!p.active) return;
        ctx.lineWidth = 3;
        ctx.strokeStyle = '#ffffff';
        if (p.type === 'ground') { ctx.fillStyle = '#3e7d37'; ctx.strokeStyle = '#1d3d1a'; }
        else if (p.type === 'moving') { ctx.fillStyle = '#00d2ff'; }
        else if (p.type === 'fragile') { ctx.fillStyle = '#d35400'; }
        else { ctx.fillStyle = '#8e44ad'; }
        ctx.beginPath(); ctx.roundRect(p.x, p.y, p.w, p.h, 6); ctx.fill(); ctx.stroke();
        if (p.type === 'fragile') {
            ctx.strokeStyle = 'rgba(0,0,0,0.7)'; ctx.lineWidth = 2; ctx.beginPath();
            ctx.moveTo(p.x + 10, p.y); ctx.lineTo(p.x + 20, p.y + 10); ctx.lineTo(p.x + 15, p.y + 18);
            ctx.moveTo(p.x + 40, p.y); ctx.lineTo(p.x + 35, p.y + 8); ctx.lineTo(p.x + 50, p.y + 18); ctx.stroke();
        }
    });
}

function initPlatforms() {
    platforms = [];
    platforms.push({ x: 0, y: canvas.height - 55, w: canvas.width, h: 60, type: 'ground', active: true });
    let currentY = canvas.height - 150;
    for (let i = 0; i < 12; i++) { platforms.push(createPlatform(currentY)); currentY -= 90; }
}

function updatePlatforms() {
    if (wizard.y < canvas.height / 2 && wizard.vy < 0) {
        let offset = -wizard.vy;
        wizard.y += offset;
        score += Math.floor(offset);
        scoreElement.innerText = score;
        platforms.forEach(p => p.y += offset);
        clouds.forEach(c => c.y += offset * 0.4);
        stars.forEach(s => s.y += offset * 0.1);
    }
    platforms = platforms.filter(p => p.y < canvas.height + 100);
    while (platforms.length > 0 && platforms[0].y > -100) {
        let lastY = platforms[0].y;
        let gap = Math.min(145, 85 + (score / 250)); 
        platforms.unshift(createPlatform(lastY - gap));
    }
    platforms.forEach(p => {
        if (!p.active) return;
        if (p.type === 'moving') {
            p.x += p.dir * (1.3 + score/7000);
            if (p.x <= 0 || p.x + p.w >= canvas.width) p.dir *= -1;
        }
        if (wizard.vy > 0 && wizard.x + wizard.w*0.7 > p.x && wizard.x + wizard.w*0.3 < p.x + p.w &&
            wizard.y + wizard.h > p.y && wizard.y + wizard.h < p.y + p.h + 15) {
            wizard.vy = jumpStrength;
            playSound(400, 'sine', 0.1, 800);
            if (p.type === 'fragile') p.active = false;
        }
    });
}

const keys = {};
window.addEventListener('keydown', e => {
    initAudio();
    if (gameState === 'start') { gameState = 'playing'; return; }
    keys[e.code] = true;
    if (gameState === 'gameover' && e.code === 'Space') restart();
});
window.addEventListener('keyup', e => keys[e.code] = false);

window.addEventListener('touchstart', e => {
    initAudio();
    if (gameState === 'start') { gameState = 'playing'; return; }
    if (gameState === 'gameover') { restart(); return; }
    const touchX = e.touches[0].clientX;
    const side = touchX < window.innerWidth / 2 ? 'KeyA' : 'KeyD';
    keys[side] = true;
}, {passive: false});

window.addEventListener('touchend', () => { keys['KeyA'] = false; keys['KeyD'] = false; });

function handleInput() {
    if (keys['ArrowLeft'] || keys['KeyA']) wizard.vx = -6;
    else if (keys['ArrowRight'] || keys['KeyD']) wizard.vx = 6;
    else wizard.vx *= 0.8;
}

function restart() {
    score = 0; scoreElement.innerText = "0";
    wizard.x = 170; wizard.y = canvas.height - 110; wizard.vy = 0; wizard.vx = 0;
    initPlatforms(); initBackdrop();
    gameState = 'playing';
}

function loop() {
    drawBackground();
    if (gameState === 'start') {
        drawPlatforms(); wizard.draw();
        ctx.fillStyle = 'rgba(0,0,0,0.85)'; ctx.fillRect(0,0,canvas.width, canvas.height);
        ctx.fillStyle = 'white'; ctx.textAlign = 'center'; ctx.font = 'bold 18px sans-serif';
        ctx.fillText('PC: A/D or ARROWS', canvas.width / 2, canvas.height / 2 - 20);
        ctx.fillText('MOBILE: TAP SIDES', canvas.width / 2, canvas.height / 2 + 10);
        ctx.fillStyle = '#00d2ff'; ctx.font = 'bold 24px sans-serif';
        ctx.fillText('TAP TO START', canvas.width / 2, canvas.height / 2 + 80);
    } else if (gameState === 'playing') {
        handleInput(); wizard.update(); updatePlatforms(); drawPlatforms(); wizard.draw();
    } else {
        ctx.fillStyle = 'rgba(0,0,0,0.8)'; ctx.fillRect(0,0,canvas.width, canvas.height);
        ctx.fillStyle = 'white'; ctx.textAlign = 'center'; ctx.font = 'bold 30px sans-serif';
        ctx.fillText('GAME OVER', canvas.width / 2, canvas.height / 2 - 20);
        ctx.font = '20px sans-serif';
        ctx.fillText('Altitude: ' + score + ' m', canvas.width / 2, canvas.height / 2 + 20);
        ctx.fillText('Tap to Restart', canvas.width / 2, canvas.height / 2 + 70);
    }
    requestAnimationFrame(loop);
}

initPlatforms(); initBackdrop(); loop();
</script>
</body>
</html>
